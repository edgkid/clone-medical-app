<!DOCTYPE html>
<html>
  <head>
    <title>Medical</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0259b8">
    <link rel="apple-touch-icon" href="/logo.jpeg">

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">   
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.0/css/jquery.dataTables.css">       
    
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
  </head>

  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    

    <%- if user_signed_in? %>

      <nav>
        <div class="nav-wrapper" style="background: #2196f3;">
          <!--<a href="#" class="brand-logo">IDET</a>-->
          <span href="#" style="position: absolute; z-index: 100; cursor: pointer;" data-target="slide-out" class="sidenav-trigger">
                <i class="material-icons" style="font-size: 38px; position: fixed; color: slategray;color:white; margin-top:10px; order-radius: 0 10px;">
                  menu
                </i>
          </span>
        </div>
      </nav>
     
      <% if current_user.user_type.upcase == 'Paciente'.upcase %>
        <%= render partial: 'menu/patient' %>
      <% end %>
      <% if current_user.user_type.upcase == 'Medico'.upcase || current_user.user_type.upcase == 'Médico'.upcase %>
        <%= render partial: 'menu/doctor' %>
      <% end %>
      <% if current_user.user_type.upcase == 'Convenio'.upcase %>
        <%= render partial: 'menu/convenio' %>
      <% end %>
      <% if current_user.user_type.upcase == 'Caja'.upcase %>
        <%= render partial: 'menu/caja' %>
      <% end %>
      <% if current_user.user_type.upcase == 'Principal'.upcase %>
        <%= render partial: 'menu/direccion_medica' %>
      <% end %>
      <% if current_user.user_type.upcase == 'Root'.upcase %>
        <%= render partial: 'menu/root' %>
      <% end %>

      <main>    
        <%= render partial: 'layouts/flash' %>
    
        <%= yield %>
      </main>

    <% else %>
      <%= yield %>
    <% end %>
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.0/js/jquery.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function(){
          var navElement = document.querySelectorAll('.sidenav');
          var instNav = M.Sidenav.init(navElement, {});   
        });

    </script>

    <script>

      var selectApp = $('select').formSelect();

    </script>

    <script>

      var bannerApp = $('.carousel').carousel();

    </script>

    <script>

      var modalApp = $('.modal').modal();
     
    </script>

    <script>

      var collapseApp = $('.collapsible').collapsible();

    </script>

    <script>

      $(document).ready(function() {
          setTimeout(function() {
              $("#flash_message").fadeOut(1500);
          },2000);
    
      });

    </script>

  <script>
      var formulario = document.getElementById('formulario');
      var inputs = document.querySelectorAll('#formulario input');
      var textareas = document.querySelectorAll('#formulario textarea');

      var expresiones = {
          name: /^[0-9a-zA-ZÀ-ÿ\s]{3,40}$/, // Letras y espacios, pueden llevar acentos.
          last_name: /^[a-zA-ZÀ-ÿ\s]{3,40}$/, // Letras y espacios, pueden llevar acentos.
          middle_name:/^[a-zA-ZÀ-ÿ\s]{3,40}$/, // Letras y espacios, pueden llevar acentos.
          surname: /^[a-zA-ZÀ-ÿ\s]{5,40}$/, // Letras y espacios, pueden llevar acentos.
          email: /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,
          address: /^[0-9a-zA-ZÀ-ÿ #-:.;_\s]{5,100}$/, // Letras y espacios, pueden llevar acentos.
          phone: /^([0-9]){11,11}$/, // 7 a 14 numeros.
          document: /^([0-9]){7,8}$/, // 7 a 14 numeros.
          reference_number: /^([0-9]){4,15}$/, // 7 a 14 numeros.
          cost: /^([0-9]){1,3}$/, // 7 a 14 numeros.
          total_appointments: /^([0-9]){1,3}$/,
          specialty:/^[a-zA-ZÀ-ÿ\s]{5,40}$/,
          description: /^[0-9a-zA-ZÀ-ÿ #-:.;_\s]{5,100}$/,
          rif: /^([-0-9]){8,10}$/,
          sanidad: /^([0-9]){1,6}$/,
          code_doctor: /^[0-9a-zA-ZÀ-ÿ\s]{1,6}$/,
          code_offer: /^[0-9a-zA-ZÀ-ÿ\s]{1,6}$/,
          code: /^[0-9a-zA-Z\s]{1,40}$/,
          password: /^[0-9a-zA-ZÀ-ÿ_.-\s]{6,20}$/,
          password_confirmation: /^[0-9a-zA-ZÀ-ÿ_.-\s]{6,20}$/,
          diagnostic_code: /^[0-9a-zA-Z\s _-]{1,6}$/,
          doctor:  /^[a-zA-ZÀ-ÿ\s]{1,40}$/,
          insurance: /^[0-9a-zA-ZÀ-ÿ\s]{3,40}$/,
          company: /^[0-9a-zA-ZÀ-ÿ\s]{3,40}$/,
          diagnostic_code: /^[0-9a-zA-ZÀ-ÿ *()#-:.;_\s]{2,5}$/,
          diagnostic_des: /^[0-9a-zA-ZÀ-ÿ #()*-:.;_\s]{5,200}$/

      }

      var campos = {
          name: false,
          last_name: false,
          middle_name: false,
          surname: false,
          phone: false,
          address: false,
          document: false,
          reference_number: false,
          email: false,
          cost: false,
          total_appointments: false,
          specialty: false,
          description: false,
          rif:false,
          sanidad: false,
          code_doctor: false,
          code_offer: false, 
          code: false,
          password: false,
          password_confirmation: false,
          diagnostic_code: false,
          doctor: false,
          insurance: false,
          company: false,
          diagnostic_code: false,
          diagnostic_des: false
      }

      var validarFormulario = (e) => {
          switch (e.target.name) {
              case "name":
                  validarCampo(expresiones.name, e.target, 'name');
              break;
              case "last_name":
                  validarCampo(expresiones.last_name, e.target, 'last_name');
              break;
              case "middle_name":
                  validarCampo(expresiones.middle_name, e.target, 'middle_name');
              break;
              case "surname":
                  validarCampo(expresiones.surname, e.target, 'surname');
              break;
              case "document":
                  console.log("document")
                  validarCampo(expresiones.document, e.target, 'document');
              break;
              case "phone":
                  validarCampo(expresiones.phone, e.target, 'phone');
              break;
              case "address":
                  validarCampo(expresiones.address, e.target, 'address');
              break;
              case "reference_number":
                  validarCampo(expresiones.reference_number, e.target, 'reference_number');
              break;
              case "email":
                  validarCampo(expresiones.email, e.target, 'email');
              break;
              case "cost":
                  validarCampo(expresiones.cost, e.target, 'cost');
              break;
              case "total_appointments":
                  validarCampo(expresiones.total_appointments, e.target, 'total_appointments');
              break;
              case "specialty":
                  validarCampo(expresiones.specialty, e.target, 'specialty');
              break;
              case "description":
                  validarTextArea(expresiones.description, e.target, 'description');
              break;
              case "password":
                  validarCampo(expresiones.password, e.target, 'password');
              break;
              case "password_confirmation":
                  validarCampo(expresiones.password_confirmation, e.target, 'password_confirmation');
              break;
              case "rif":
                  validarCampo(expresiones.rif, e.target, 'rif');
              break;
              case "sanidad":
                  validarCampo(expresiones.sanidad, e.target, 'sanidad');
              break;
              case "code_doctor":
                  validarCampo(expresiones.code_doctor, e.target, 'code_doctor');
              break;
              case "code_offer":
                  validarCampo(expresiones.code_offer, e.target, 'code_offer');
              break;
              case "code":
                  validarCampo(expresiones.code, e.target, 'code');
              break;
              case "doctor":
                  validarCampo(expresiones.doctor, e.target, 'doctor');
              break;
              case "insurance":
                  validarCampo(expresiones.insurance, e.target, 'insurance');
              break;
              case "company":
                  validarCampo(expresiones.company, e.target, 'company');
              break;
              case "diagnostic_code":
                  validarCampo(expresiones.diagnostic_code, e.target, 'diagnostic_code');
              break;
              case "diagnostic_des":
                  validarTextArea(expresiones.diagnostic_des, e.target, 'diagnostic_des');
              break;
          }
      }

      var validarCampo = (expresion, input, campo) => {
          if(expresion.test(input.value)){
              document.getElementById(`group_${campo}`).classList.remove('field-set-style-incorrecto');
              document.getElementById(`group_${campo}`).classList.remove('field-set-style');
              document.getElementById(`group_${campo}`).classList.add('field-set-style-correcto');
              campos[campo] = true;
          } else {
              document.getElementById(`group_${campo}`).classList.remove('field-set-style');
              document.getElementById(`group_${campo}`).classList.remove('field-set-style');
              document.getElementById(`group_${campo}`).classList.add('field-set-style-incorrecto');
              
              campos[campo] = false;
          }
      }

      var validarTextArea = (expresion, textarea, campo) => {
          if(expresion.test(textarea.value)){
              document.getElementById(`group_${campo}`).classList.remove('field-set-style-incorrecto');
              document.getElementById(`group_${campo}`).classList.remove('field-set-style');
              document.getElementById(`group_${campo}`).classList.add('field-set-style-correcto');
              campos[campo] = true;
          } else {
              document.getElementById(`group_${campo}`).classList.remove('field-set-style');
              document.getElementById(`group_${campo}`).classList.remove('field-set-style');
              document.getElementById(`group_${campo}`).classList.add('field-set-style-incorrecto');
              
              campos[campo] = false;
          }
      }

      inputs.forEach((input) => {
          input.addEventListener('keyup', validarFormulario);
          input.addEventListener('blur', validarFormulario);
      });

      textareas.forEach((textarea) => {
          textarea.addEventListener('keyup', validarFormulario);
          textarea.addEventListener('blur', validarFormulario);
      });


    </script>
    
    <script>
        var selectTwo = $(document).ready(function() {
          $('.select-2-multiple').select2();
      });
    </script>

    <script>
      var coll = document.getElementsByClassName("collapsible-list");
      var i;

      for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
          this.classList.toggle("active");
          var content = this.nextElementSibling;
          if (content.style.display === "block") {
            content.style.display = "none";
          } else {
            content.style.display = "block";
          }
        });
      }
    </script>

    <script>
      var handleFileSelectDelete = function(evt) {
          var files = evt.target.files;
          var file = files[0];
          var reader = new FileReader();

              reader.onload = function(readerEvt) {
                  var binaryString = readerEvt.target.result;
                  var fileending = file.type;

                  var test = btoa(binaryString);
                  var final = test;

                  document.getElementById("file_name_delete").value = final
                  document.getElementById("nameDelete").value = file.name

              };

              reader.readAsBinaryString(file);
      };

      var handleFileSelectActive = function(evt) {
          var files = evt.target.files;
          var file = files[0];
          var reader = new FileReader();

              reader.onload = function(readerEvt) {
                  var binaryString = readerEvt.target.result;
                  var fileending = file.type;

                  var test = btoa(binaryString);
                  var final = test;

                  document.getElementById("file_name_active").value = final
                  document.getElementById("nameActive").value = file.name

              };

              reader.readAsBinaryString(file);
      };

      var handleFileSelectNew = function(evt) {
          var files = evt.target.files;
          var file = files[0];
          var reader = new FileReader();

              reader.onload = function(readerEvt) {
                  var binaryString = readerEvt.target.result;
                  var fileending = file.type;

                  var test = btoa(binaryString);
                  var final = test;

                  document.getElementById("file_name_new").value = final
                  document.getElementById("nameNew").value = file.name

              };

              reader.readAsBinaryString(file);
      };

      var handleFileSelectDiagnostic = function(evt) {
          var files = evt.target.files;
          var file = files[0];
          var reader = new FileReader();

              reader.onload = function(readerEvt) {
                  var binaryString = readerEvt.target.result;
                  var fileending = file.type;

                  var test = btoa(binaryString);
                  var final = test;

                  document.getElementById("file_name_diagnostic").value = final
                  document.getElementById("nameDiagnostic").value = file.name

              };

              reader.readAsBinaryString(file);
      };

      if (window.File && window.FileReader && window.FileList && window.Blob) {
          document.getElementById('filecsvDelete')?.addEventListener('change', handleFileSelectDelete, false);
          document.getElementById('filecsvActive')?.addEventListener('change', handleFileSelectActive, false);
          document.getElementById('filecsvNew')?.addEventListener('change', handleFileSelectNew, false);
          document.getElementById('filecsvDiagnostic')?.addEventListener('change', handleFileSelectDiagnostic, false);
      } else {
          alert('The File APIs are not fully supported in this browser.');
      }
  </script>

  <script>
    function setValuesFilterForPrint() {

      var startDate = null;
      var endDate = null;
      //var company = null;
      //var insurance = null;

      startDate = document.getElementById("ini_date").value;
      endDate = document.getElementById("end_date").value;
      //company = document.getElementById("company").value;
      //insurance = document.getElementById("insurance").value;

      $('#ini_date_print').val(startDate);
      $('#end_date_print').val(endDate);
      //$('#company').val(company);
      //$('#insurance').val(insurance);
    }

  </script>

  <!--<script>
    var table = $(document).ready( function () {
      $('#DataTableId').DataTable({
      responsive: true,
      language: {
          "decimal": "",
          "emptyTable": "No se encontraron registros",
          "info": "Mostrando _START_ de _END_ / _TOTAL_ Registros",
          "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
          "infoFiltered": "(Filtrado de _MAX_ total registros)",
          "infoPostFix": "",
          "thousands": ",",
          //"lengthMenu": "Mostrar _MENU_ Registros",
          "lengthMenu": "",
          "loadingRecords": "Cargando...",
          "processing": "Procesando...",
          "search": "Buscar:",
          "zeroRecords": "No se encontraron registros....",
          "paginate": {
              "first": "Primero",
              "last": "Ultimo",
              "next": "Siguiente",
              "previous": "Anterior"
          }
      },
      buttons: [
            'copy', 'print', 'excel', 'pdf'
        ],
      "pageLength": 10
    });
    } );
  </script>-->
  </body>
</html>
