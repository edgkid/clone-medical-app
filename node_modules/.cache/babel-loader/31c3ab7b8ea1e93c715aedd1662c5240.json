{"ast":null,"code":"import consumer from \"./consumer\";\nimport moment from 'moment';\nvar current_user_id;\nvar chat_id;\nconsumer.subscriptions.create(\"RoomChannel\", {\n  connected: function connected() {\n    // Called when the subscription is ready for use on the server\n    // mandar a los usuarios que se conecto el medico\n    console.log('connected');\n  },\n  disconnected: function disconnected() {// Called when the subscription has been terminated by the server\n  },\n  received: function received(data) {\n    if (data.action == 'new') {\n      if ($(\"tr#\".concat(data.user.id)).length === 0) {\n        $('#doctor-table').append(\"\\n          <tr  id=\\\"\".concat(data.user.id, \"\\\">\\n            <td>\\n              <p style=\\\"font-family: FuturaStd Medium\\\">\").concat(data.user.speciality, \"</p>\\n            </td>\\n            <td>\\n              <p style=\\\"font-family: FuturaStd Medium\\\">\\n                \").concat(data.user.full_name, \"\\n              </p>\\n            </td>\\n            <td>\\n              <i class=\\\"material-icons green-text\\\"> brightness_1 </i>\\n            <td>\\n              \").concat($('#doctor-table').data('patient-plan-status') == 'APROBADO' && Number($('#doctor-table').data('patient-plan-count')) > 0 ? \"<a class=\\\"modal-trigger\\\" style=\\\"color:#039BE5;\\\" href=\\\"#idModalAlertaDeCosumo\\\" onclick=\\\"setDataModalCounAppointment('\".concat($('#doctor-table').data('patient'), \"%\").concat(data.user.doctor_id, \"%true')\\\">Iniciar Chat</a>\") : \"<a class=\\\"modal-trigger\\\" style=\\\"color:#039BE5;\\\" href=\\\"#idModalAlertaDeCosumo\\\" onclick=\\\"setDataModalCounAppointment('\".concat($('#doctor-table').data('patient'), \"%\").concat(data.user.doctor_id, \"%false')\\\">Iniciar Chat</a>\"), \"\\n            </td>\\n          </tr> \\n        \"));\n      }\n    } else if (data.action == 'remove') {\n      $(\"tr#\".concat(data.user)).remove();\n    } else if (data.action == 'new_message') {\n      var message = JSON.parse(data.message);\n      var content = '';\n      console.log(message);\n      if (message.chat_id !== chat_id) return;\n      if (message.content) content = message.content;else if (message.image_url) content = \"\\n          <a href=\\\"\".concat(message.image_url, \"\\\"><img class=\\\"img-chat responsive-img\\\" src=\\\"\").concat(message.image_url, \"\\\"></a>\\n        \");else content = 'Error al mostrar contenido';\n      $('#messages').append(\"\\n        <div id=\\\"msg\\\" style=\\\"display: flow-root\\\">\\n          <div \\n            class=\\\"message \\\"\\n            style=\\\"\\n              padding: 1px 30px;\\n              margin: 10px 0;\\n              background: white;\\n\\n              \".concat(message.user_id === current_user_id ? 'text-align: right; float: right; border-radius: 10px 0px 30px 10px;' : 'text-align: left; float: left; border-radius:   0px 10px 10px 30px;', \"\\n              \\n              \\n              \", \"\\n              \", \"\\n              \", \"\\n              \", \"\\n            \\\"\\n          >\\n            <div class=\\\"message-content\\\">\\n                \").concat(content, \"\\n            </div>\\n            <div \\n                class=\\\"message-hour\\\"\\n                style=\\\" color: #9c9a9a;\\n                        font-size: 8pt;\\n                \\\"\\n            >\\n              <span>\").concat(moment(message.created_at, '').format('DD/MM/YYYY h:mm a'), \"</span>\\n            </div>\\n          </div>\\n        </div>\\n      \")); // Called when there's incoming data on the websocket for this channel\n\n      var messagesDiv = document.querySelector(\"#messages\");\n      messagesDiv.scrollTo(0, messagesDiv.scrollHeight);\n    }\n  }\n});\nvar submit_messages;\n$(document).on('turbolinks:load', function () {\n  if (!document.getElementById('chat-box')) return;\n  var messagesDiv = document.querySelector(\"#messages\");\n  messagesDiv.scrollTo(0, messagesDiv.scrollHeight);\n  current_user_id = Number($('.chat-box').data('user'));\n  chat_id = Number($('.chat-box').data('chat'));\n  submit_messages();\n  $('#message_image').on('change', function (event) {\n    if (event.target.files.length > 0) {\n      $('#submit-button').click();\n      event.target.value = '';\n      event.preventDefault();\n    }\n  });\n});\n\nsubmit_messages = function submit_messages(params) {\n  $('#messages_content').on('keydown', function (event) {\n    if (event.keyCode == 13) {\n      $('#submit-button').click();\n      event.target.value = '';\n      event.preventDefault();\n    }\n\n    $('#submit-button').on('click', function (event) {\n      setTimeout(function () {\n        $('#messages_content').val('');\n      }, 100);\n    });\n  });\n};","map":{"version":3,"sources":["/home/edgar/Escritorio/AppMedica/medical/app/javascript/channels/room_channel.js"],"names":["consumer","moment","current_user_id","chat_id","subscriptions","create","connected","console","log","disconnected","received","data","action","$","user","id","length","append","speciality","full_name","Number","doctor_id","remove","message","JSON","parse","content","image_url","user_id","created_at","format","messagesDiv","document","querySelector","scrollTo","scrollHeight","submit_messages","on","getElementById","event","target","files","click","value","preventDefault","params","keyCode","setTimeout","val"],"mappings":"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","sourcesContent":["import consumer from \"./consumer\"\nimport moment from 'moment'\n\nvar current_user_id;\nvar chat_id;\nconsumer.subscriptions.create(\"RoomChannel\", {\n  connected() {\n    // Called when the subscription is ready for use on the server\n    // mandar a los usuarios que se conecto el medico\n    console.log('connected')\n  },\n\n  disconnected() {\n    // Called when the subscription has been terminated by the server\n  },\n\n  received(data) {\n    if(data.action == 'new') {\n      if($(`tr#${data.user.id}`).length === 0) {\n        $( '#doctor-table' ).append(`\n          <tr  id=\"${data.user.id}\">\n            <td>\n              <p style=\"font-family: FuturaStd Medium\">${data.user.speciality}</p>\n            </td>\n            <td>\n              <p style=\"font-family: FuturaStd Medium\">\n                ${data.user.full_name}\n              </p>\n            </td>\n            <td>\n              <i class=\"material-icons green-text\"> brightness_1 </i>\n            <td>\n              ${\n                $('#doctor-table').data('patient-plan-status') == 'APROBADO' && Number($('#doctor-table').data('patient-plan-count')) > 0 ?\n                `<a class=\"modal-trigger\" style=\"color:#039BE5;\" href=\"#idModalAlertaDeCosumo\" onclick=\"setDataModalCounAppointment('${$('#doctor-table').data('patient')}%${data.user.doctor_id}%true')\">Iniciar Chat</a>` \n                :\n                `<a class=\"modal-trigger\" style=\"color:#039BE5;\" href=\"#idModalAlertaDeCosumo\" onclick=\"setDataModalCounAppointment('${$('#doctor-table').data('patient')}%${data.user.doctor_id}%false')\">Iniciar Chat</a>` \n              }\n            </td>\n          </tr> \n        `)\n      }   \n    } else if(data.action == 'remove') {\n      $( `tr#${data.user}` ).remove();\n    } else if(data.action == 'new_message') {\n      let message = JSON.parse(data.message)\n      let content = ''\n\n      console.log(message)\n\n      if(message.chat_id !== chat_id)\n        return\n\n      if(message.content)\n        content = message.content\n      else if(message.image_url)\n        content = `\n          <a href=\"${message.image_url}\"><img class=\"img-chat responsive-img\" src=\"${message.image_url}\"></a>\n        `\n      else \n        content = 'Error al mostrar contenido'\n\n      $('#messages').append(`\n        <div id=\"msg\" style=\"display: flow-root\">\n          <div \n            class=\"message \"\n            style=\"\n              padding: 1px 30px;\n              margin: 10px 0;\n              background: white;\n\n              ${message.user_id === current_user_id ? 'text-align: right; float: right; border-radius: 10px 0px 30px 10px;' : 'text-align: left; float: left; border-radius:   0px 10px 10px 30px;'}\n              \n              \n              ${/*message.user == 'patient' && user == 'patient' ? 'text-align: right; float: right; border-radius: 10px 0px 30px 10px;' : '' */''}\n              ${/*message.user == 'doctor' && user == 'doctor' ? '  text-align: right; float: right; border-radius: 10px 0px 30px 10px;' : '' */''}\n              ${/*message.user == 'patient' && user == 'doctor' ? ' text-align: left; float: left; border-radius:   0px 10px 10px 30px;' : '' */''}\n              ${/*message.user == 'doctor' && user == 'patient' ? ' text-align: left; float: left; border-radius:   0px 10px 10px 30px;' : '' */''}\n            \"\n          >\n            <div class=\"message-content\">\n                ${ content }\n            </div>\n            <div \n                class=\"message-hour\"\n                style=\" color: #9c9a9a;\n                        font-size: 8pt;\n                \"\n            >\n              <span>${ moment(message.created_at, '').format('DD/MM/YYYY h:mm a') }</span>\n            </div>\n          </div>\n        </div>\n      `)\n      // Called when there's incoming data on the websocket for this channel\n      const messagesDiv = document.querySelector(\"#messages\") \n      messagesDiv.scrollTo(0, messagesDiv.scrollHeight)\n    }\n  }\n});\n\nvar submit_messages;\n$(document).on('turbolinks:load', function () {\n  if(!document.getElementById('chat-box'))\n    return\n\n  const messagesDiv = document.querySelector(\"#messages\") \n  messagesDiv.scrollTo(0, messagesDiv.scrollHeight)\n\n  current_user_id = Number($('.chat-box').data('user'))\n  chat_id = Number($('.chat-box').data('chat'))\n\n  submit_messages()\n\n  $('#message_image').on('change', function (event) {\n    if(event.target.files.length > 0){\n      $('#submit-button').click()\n      event.target.value = ''\n      event.preventDefault()\n    }\n  })\n})\n\nsubmit_messages = function(params) {\n  $('#messages_content').on('keydown', function (event) {\n    if(event.keyCode == 13){\n      $('#submit-button').click()\n      event.target.value = ''\n      event.preventDefault()\n      \n    }\n\n    $('#submit-button').on('click', function(event) {\n      setTimeout(function() {\n        $('#messages_content').val('')\n      }, 100);\n    });\n\n  })\n}\n\n"]},"metadata":{},"sourceType":"module"}